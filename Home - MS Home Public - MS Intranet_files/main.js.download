var personalLinks=function(){return{addLink:function(f,d,e){var g=!0;Liferay.Service("/magna.link/add-link",f,function(k){e({success:g,linkId:k.linkId});Liferay.Service("/magna.folderlinkmap/add-link-to-folder",{linkId:k.linkId,folderId:d})},function(k){console.log(k);g=!1})},updateLink:function(f,d,e){var g=!0;Liferay.Service("/magna.link/update-link",f,function(k){d!=e&&Liferay.Service("/magna.folderlinkmap/add-link-to-folder",{linkId:k.linkId,folderId:d},function(q){Liferay.Service("/magna.folderlinkmap/delete-mapping",
{linkId:q.linkId,folderId:e})})},function(k){console.log(k);g=!1});return g},removeLink:function(f){var d=!0;Liferay.Service("/magna.link/delete-link",{linkId:f},function(e){},function(e){console.log(e);d=!1});return d},addFolder:function(f,d,e){var g=!0;Liferay.Service("/magna.folder/add-folder",{parentId:d,title:f},function(k){e({success:g,folderId:k.folderId})},function(k){console.log(k);g=!1})},removeFolder:function(f){var d=!0;Liferay.Service("/magna.folder/delete-folder",{folderId:f},function(e){},
function(e){console.log(e);d=!1});return d},updateFolder:function(f,d,e){var g=!0;Liferay.Service("/magna.folder/update-folder",{folderId:d,title:f},function(k){e({success:g,folderId:k.folderId})},function(k){console.log(k);g=!1})}}}();
$(document).ready(function(){loadPersonalTreeEvents();var f=$(".bookmarks .has-submenu .has-submenu");f.length&&$.each(f,function(d){var e=$(this);e.on("mouseenter",function(g){g=e.children(".submenu");if(g.length&&0>g.offset().top){console.log("moving submenu down...");var k=-1*g.offset().top+10;g.css("transform","translate(0, "+k+"px)")}g.is(":entireonscreen")?console.log("submenu is entirely on screen - nothing to do here"):(console.log("submenu offscreen - moving it to the left"),g.css("transform",
"translateX(-660px)"))})})});
function loadPersonalTreeEvents(){function f(a,c,b){var h=$("#"+c),l=h.find("ul"),m=$("#userRootFolderId").val(),n=$("#newLinkDom").clone();n.find("a").first().text(a.title);n.find("a").first().attr("href",a.linkurl);n.attr("id",b);n.find(".edit-link").click(function(r){e($(this))});n.find(".remove-link").click(function(r){g($(this))});c==m?$(".bookmarks .personal-folder").last().after(n):0==l.length?(h.addClass("has-submenu"),a=$('\x3cul class\x3d"submenu"\x3e'),a.append(n),h.append(a)):l.append(n)}
function d(a,c,b){var h=$("#"+b),l=h.find("ul");a=$("#"+a);var m=$("#userRootFolderId").val();a.remove();a.find(".edit-link").click(function(n){e($(this))});a.find(".remove-link").click(function(n){g($(this))});a.find("a").first().text(c.title);a.find("a").first().attr("href",c.linkurl);b==m?$(".bookmarks .personal-folder").last().after(a):0==l.length?(h.addClass("has-submenu"),c=$('\x3cul class\x3d"submenu"\x3e'),c.append(a),h.append(c)):l.append(a)}function e(a){p.attr("mode","1");s.find(".modal-header h4").text($("#editLinkTitle").text());
s.find(".btn-save").text($("#editLinkBtn").text());var c=a.parent().attr("id");a=a.closest(".personal-folder").attr("id");var b=$("#"+c);p.attr("update-link-id",c);p.attr("update-link-folder-id",a);c=b.find("a").first().text();b=b.find("a").first().attr("href");$("#linkTitle",p).val(c);$("#linkUrl",p).val(b);$("#linkFolder",p).find("option[id\x3d"+a+"]").prop("selected",!0);s.modal("show")}function g(a){a=a.parent().attr("id");x.attr("item-id",a);x.attr("item-type","l");y.modal("show")}function k(a,
c){var b=$("#new-folder-dom").clone(),h=$("#personal-folders-list li:last",t);b.find("span").text(c);b.attr("id",a);b.find(".remove-folder").click(function(l){l=$(this).parent().attr("id");q(l)});b.find(".edit-folder").click(function(l){l=$(this).parent().attr("id");v(l)});h.before(b);b=$("#new-folder-dom-nav").clone();b.attr("id",a);b.find("a").text(c);$(".bookmarks .personal-folder").last().after(b);b=$("\x3coption\x3e");b.attr("id",a);b.text(c);$("#linkFolder",p).append(b)}function q(a){x.attr("item-id",
a);x.attr("item-type","f");y.modal("show")}function v(a){var c=t.find("#"+a),b=$("#new-folder-form").clone(),h=$("#newFolderTitle",b);h.val(c.find("span").text());b.removeClass("hidden");$("form",b).unbind("submit").bind("submit",function(m){var n=$(this),r=$("#newFolderTitle",n),n=z(r,A);""!=r.val()&&personalLinks.updateFolder(n,a,function(u){u.success&&(console.log("edited"),u=r.val(),t.find("#"+a).find("span").text(u),$(".bookmarks").find("#"+a).find(" \x3e a").first().text(u),$("#linkFolder",
p).find("#"+a).text(u),c.find("span").text(u),l())});m.stopPropagation();m.preventDefault()});c.replaceWith(b);h.focus();var l=function(){c.find(".remove-folder").click(function(m){m=$(this).parent().attr("id");q(m)});c.find(".edit-folder").click(function(m){m=$(this).parent().attr("id");v(m)});b.replaceWith(c);b.remove()}}function w(a){var c=!1;$.each(a,function(b,h){""===h.val()&&(h.addClass("validate-input-required"),c=!0)});return c}function B(a){a.find("input").val("");a.find("input[type\x3dtext]").removeClass("validate-input-required");
a.find("input[type\x3dtext]").attr("placeholder","");a.find("select")[0].selectedIndex=0}function z(a,c){var b="{";"en_US"!=c&&(b+='"'+c+'" : "'+a.val()+'" ,');return b+=' "en_US" : "'+a.val()+'" }'}var s=$("#addLink"),t=$("#manageFolders"),y=$("#confirmDelete"),p=$("form",s),x=$("form",y);$("form",t);var A=p.attr("locale");p.unbind("submit").bind("submit",function(a){var c=$(this),b=c.attr("mode"),h=$("#linkTitle",c),l=$("#linkUrl",c),m=$("#linkFolder",c).find("option:selected").attr("id"),n={title:z(h,
A),linkurl:z(l,A)},r={title:h.val(),linkurl:l.val()};w([h,l])||("0"==b?personalLinks.addLink(n,m,function(u){u.success&&(f(r,m,u.linkId),B(c),s.modal("hide"))}):(b=c.attr("update-link-id"),h=c.attr("update-link-folder-id"),n.linkId=b,personalLinks.updateLink(n,m,h)&&(s.modal("hide"),B(c),d(b,r,m))));a.stopPropagation();a.preventDefault()});x.unbind("submit").bind("submit",function(a){var c=$(this),b=c.attr("item-id"),c=c.attr("item-type");if("l"==c&&personalLinks.removeLink(b)){var h=$("#"+b);0==
h.siblings().length&&(h.parent().parent().removeClass("has-submenu"),h.parent().remove());h.remove();y.modal("hide")}"f"==c&&personalLinks.removeFolder(b)&&(t.find("#"+b).remove(),$(".bookmarks").find("#"+b).remove(),$("#linkFolder",p).find("#"+b).remove(),y.modal("hide"));a.stopPropagation();a.preventDefault()});s.on("hidden.bs.modal",function(){B(p)});$(".add-link").click(function(a){p.attr("mode","0");s.find(".modal-header h4").text($("#addLinkTitle").text());s.find(".btn-save").text($("#addLinkBtn").text());
s.modal("show")});$(".edit-link").click(function(a){e($(this))});$(".remove-link").click(function(a){g($(this))});$(".new-folder",t).click(function(a){var c=$("#personal-folders-list li:last",t),b=$("#new-folder-form").clone();b.addClass("nffa");b.removeClass("hidden");0<$(".nffa").length?(a.stopPropagation(),a.preventDefault()):(c.before(b),$("form",b).unbind("submit").bind("submit",function(h){var l=$(this),m=$("#newFolderTitle",l),l=z(m,A);if(""!=m.val()){var n=$("#userRootFolderId").val();personalLinks.addFolder(l,
n,function(r){r.success&&(k(r.folderId,m.val()),$(".nffa").remove())})}h.stopPropagation();h.preventDefault()}))});$(".remove-folder",t).click(function(a){a=$(this).parent().attr("id");q(a)});$(".edit-folder",t).click(function(a){a=$(this).parent().attr("id");v(a)})}function doPortalSearch(f){var d=document.getElementById("mssearchField").value;f+=encodeURIComponent(d);location.hash=f;return!1}
function doPortalSearchKeyPress(f,d){if(13==(f.keyCode?f.keyCode:f.which)){var e=document.getElementById("mssearchField").value,e=d+encodeURIComponent(e);location.hash=e;return!1}}
$.fn.isOnScreen=function(f){var d=$(this).first()[0].getBoundingClientRect(),e={h:$(window).height(),w:$(window).width()},g=0<=d.top&&d.top<=e.h,k=0<=d.bottom&&d.bottom<=e.h,q=0<=d.left&&d.left<=e.w,v=0<=d.right&&d.right<=e.w,w=0>=d.left&&d.right>=e.w,e=0>=d.top&&d.bottom>=e.h,d=g&&(q||v||w),w=k&&(q||v||w),q=q&&(g||k||e),g=v&&(g||k||e);return f?d||w||q||g:d&&w&&q&&g};$.expr.filters.onscreen=function(f){return $(f).isOnScreen(!0)};$.expr.filters.entireonscreen=function(f){return $(f).isOnScreen(!1)};